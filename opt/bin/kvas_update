#!/bin/sh
# ------------------------------------------------------------------------------------------
#	 Вспомогательные переменные для работы скрипта
# ------------------------------------------------------------------------------------------
. /opt/bin/unblock_lib

# Флаг пропуска блокировки рекламы
# 0-вЫключаем блокиратор рекламы,
# 1 - включаем блокиратор рекламы
ADS_BLOCKER_ON=0
# "Процесс обновления списка рекламы..."
if [ -z "$1" ] && [ "${ADS_BLOCKER_ON}" = 1 ]; then
	/opt/bin/update_adblock
	print_line
fi

ready "Обновление списка dnsmasq"
ipset flush unblock
/opt/bin/unblock_dnsmasq
[ $? = 0 ] && when_ok "ГОТОВО" || when_bad "ОШИБКА"

ready "Перезапуск службы dnsmasq"
/opt/etc/init.d/S56dnsmasq restart &>/dev/null
[ $? = 0 ] && when_ok "ГОТОВО" || when_bad "ОШИБКА"

ready "Обновление таблицы ipset"
/opt/bin/unblock_ipset &
[ $? = 0 ] && when_ok "ГОТОВО" || when_bad "ОШИБКА"

print_line
date_update
print_line